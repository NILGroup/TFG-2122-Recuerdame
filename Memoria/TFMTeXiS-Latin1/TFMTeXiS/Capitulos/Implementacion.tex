\chapter{Implementación de la aplicación}
\label{cap:implementacionDelTFG}
Para este TFG se ha desarrollado una aplicación web que será adaptable a dispositivo tablet. En este capitulo mostraremos la arquitectura que se ha decidido para la aplicación así como el diseño de la base de datos implementado. Además se mostrará cuales fueron las herramientas utilizadas y como fue implementada la aplicación

Todas nuestras decisiones fueron tomadas a partir de las requisitos y las especificaciones pedidas por los expertos que utilizaran la aplicación.

\section{Arquitectura}
Para la arquitectura de la aplicación se ha utilizado el patrón Modelo-Vista-Controlador (MVC). Este patrón se basa en separar la interfaz de usuario de la lógica de negocio y lo hace separando el código en 3 bloques:
\begin{itemize}
	\item \textbf{Modelo:} Es el encargado de gestionar la información almacenada en la base de datos y transformar los datos según las reglas de negocio.
	\item \textbf{Controlador:} Actúa de intermediario entre el Modelo y la Vista. La Vista realiza una petición al Controlador y éste se encarga de obtener los datos a través del Modelo y enviarlos a la Vista.
	\item \textbf{Vista:} Es la interfaz de usuario. Se encarga de realizar peticiones de datos al Controlador y mostrar la información necesaria con la que el usuario pueda interactuar.
\end{itemize}
Un ejemplo de este flujo entre los 3 bloques se puede ver en la Figura \ref{fig:str_mvc}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=5cm]{./Imagenes/Figuras/mvc_structure.png}
	\caption{Estructura de Modelo-Vista-Controlador}
	\label{fig:str_mvc}
\end{figure}
			
Esta decisión fue tomada debido a las grandes ventajas que este modelo impone en el código, algunas de estas son:
\begin{itemize}
	\item La separación clara de dónde tiene que ir cada tipo de lógica, facilita el mantenimiento y la escalabilidad de la aplicación.
	\item La facilidad para la realización de pruebas unitarias de los componentes y para el manejo de errores.
	\item La posibilidad de mostrar múltiples representaciones de los datos.
	\item La facilidad del control de versiones. 
	\item Facilita la división de trabajo.
\end{itemize}

Para aplicar este patrón de la manera más ordenada posible aplicamos esta división a cada modulo/acción que la aplicación realiza. Algunas de estas divisiones son:
\begin{itemize}
	\item Paciente: Controla la información del paciente a tratar y permite modificar, añadir y eliminar pacientes.
	\item Usuario: Controla la información del terapeuta y permite modificar, añadir y eliminar terapeutas.
	\item Sesiones: Controla las sesiones para el usuario, permite modificar, añadir y eliminar sesiones.
	\item Informes de sesión: Controla los informes de la sesiones realizadas y finalizadas. Permite modificar, añadir y eliminar los distintos informes.
	\item Informes de seguimiento: Controla los informes de seguimiento del paciente. Permite modificar, añadir y eliminar.
	\item Historia de vida: Permite mostrar la historia de vida del paciente con distintos filtros y en distintos formatos.
	\item Recuerdos: Controla los recuerdos del usuario. Permite modificar, añadir y eliminar los recuerdos.
	\item Personas Relacionadas: Controla los contactos del usuario. Permite modificar, añadir y eliminar las distintas personas.
	\item Calendario: Muestra el calendario por mes. Permite modificar, añadir y eliminar tareas en el calendario.
\end{itemize}

Como resultado, cada modulo tendrá: por una parte distintas vistas para sus distintas acciones y, por otra, un controlador y un modelo. Por ejemplo, en el caso del modulo ``Sesiones'', una de sus vistas es ``Modificar Datos de la Sesión'' que se encarga de mostrar la pantalla para modificar los distintos datos de una sesión. Además de eso, tiene un modelo que se encarga de pedir los datos de la sesión a la base de datos y un controlador que comunica la vista con el modelo.

La implementación de esta aplicación se ha llevado a cabo con la siguientes herramientas:
\begin{itemize}
	\item Para el front-end de la aplicación hemos utilizado HTML y CSS por la facilidad de uso y generación de código. También, hemos incorporado Bootstrap para los estilos de la aplicación ya que simplifica la generación de formulario. Además, Bootstrap genera código Responsive que es uno de los requisitos para poder utilizar la aplicación en tablets. Hemos usado una librería de Bootstrap llamada Fontawesome que es un conjunto de herramientas de fuentes e iconos basado en CSS.
	 Para la conexión con el Backend hemos utilizado JavaScript por sencillez y porque es un lenguaje que conocemos todos los integrantes del grupo. Dentro de JavaScript hemos utilizado un plugin para realizar el calendario llamado FullCalendar, que ofrece bastantes facilidades para ello.
	\item Para el back-end hemos utilizado PHP porque lo hemos utilizado en otras asignaturas y nos resulta muy familiar.
	\item Para almacenar los datos hemos utilizado el motor de base de datos MySQL porque es de código abierto.
	\item Como servidor local hemos utilizado Xampp porque es un servidor de plataforma libre y nos da muchas facilidades porque integra varias aplicaciones (MySQL, PHP). Además, se puede ejecutar en diversos sistemas operativos que nos ha facilitado colaborar en equipo.
	\item Como herramienta de control de versiones hemos utilizao GitHub ya que es donde alojamos todo el material del TFG.
	\item Para desarrollar la aplicación utilizamos  Visual Studio Code como editor de código puesto que consideramos que es el más completo y con el que más familiarizados estamos.
	\item Para el desarrollo de la lógica de la aplicación hemos aplicado programación orientada a objetos para tratar los diferentes elementos con los que trabaja el backend de la aplicación.
\end{itemize}

\section{Base de datos}
Tras realizar un estudio cerciorado de las necesidades del proyecto. Observamos que para el modelo de datos de la aplicación, teníamos que decidir entre dos opciones: coger una base de datos relacional o una base de datos no relacional.

Las bases de datos no relacionales están pensadas para ser utilizadas cuando: la estructura de la base datos no tiene esquemas específicos, se guardan grandes cantidades de información o se realizan grandes movimientos de datos en momentos puntuales. Lo cual no es el caso de nuestra aplicación. Ademas su compatibilidad con servidores y distintos sistemas operativos es mas complicada. Por lo mencionado anteriormente, decidimos que la mejor forma de guardar la base de datos de nuestra aplicación sería una base de datos relacional, y entre ellas escogimos MySQL. Por varias razones:
\begin{itemize}
	\item Su portabilidad: puede ser usado en distintos dispositivos como ordenadores, tablets y moviles.
	\item Su gratuidad, al ser código abierto no requiere de ningún coste.
	\item Su eficiencia: necesita pocos requerimientos y ocupa poca memoria.
	\item Su experiencia: al ser uno de los mas usados, existe gran cantidad de información.
	\item Su seguridad: al tratar con datos muy personales de alto riesgo, es muy importante estar seguros de donde se están alojando esos datos. MySQL es altamente seguro, gracias a varias funciones avanzadas de seguridad.
\end{itemize}	

La estructura de la base de datos (Figura \ref{fig:str_bd}) fue definida, en parte, por toda la información aportada por los terapeutas durante las entrevistas y durante la evaluación del diseño competitivo.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=17cm]{./Imagenes/Figuras/estructura_bd.jpeg}
	\caption{Estructura de la base de datos}
	\label{fig:str_bd}
\end{figure}

\subsection{Tabla usuario}
Contiene toda la información de los usuarios (terapeutas y cuidadores) que pueden iniciar sesión en la aplicación. Los atributos se pueden ver en la Figura \ref{fig:bd_usuario}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/usuario.png}
	\caption{Tabla de base de datos usuario.}
	\label{fig:bd_usuario}
\end{figure}

\subsection{Tabla paciente}
Tabla con la información de los pacientes a tratar que podrán ser asignados a los terapeutas o a un cuidador. Los atributos se pueden ver en la Figura \ref{fig:bd_paciente}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/paciente.png}
	\caption{Tabla de base de datos paciente.}
	\label{fig:bd_paciente}
\end{figure}

Esta tabla tiene las siguientes foreign keys:
\begin{itemize}
	\item \verb|FK_CUIDADOR_PACIENTE|: referencia a la tabla usuario.
\end{itemize}

\subsection{Tabla sesion}
Tabla con la información de las sesiones que el terapeuta realiza con los pacientes. Los atributos se pueden ver en la Figura \ref{fig:bd_sesion}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/sesion.png}
	\caption{Tabla de base de datos sesion.}
	\label{fig:bd_sesion}
\end{figure}

Esta tabla tiene las siguientes foreign keys:
\begin{itemize}
	\item \verb|FK_SESION_ETAPA|: referencia a la tabla etapa.
	\item \verb|FK_SESION_PACIENTE|: referencia a la tabla paciente.
	\item \verb|FK_SESION_USUARIO|: referencia a la tabla usuario.
\end{itemize}

\subsection{Tabla recuerdo}
Tabla con la información de los recuerdos de todos los pacientes. Los atributos se pueden ver en la Figura \ref{fig:bd_recuerdo}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/recuerdo.png}
	\caption{Tabla de base de datos recuerdo.}
	\label{fig:bd_recuerdo}
\end{figure}

Esta tabla tiene las siguientes foreign keys:
\begin{itemize}
	\item \verb|FK_RECUERDO_CATEGORIA|: referencia a la tabla categoria.
	\item \verb|FK_RECUERDO_EMOCION|: referencia a la tabla emocion.
	\item \verb|FK_RECUERDO_ESTADO|: referencia a la tabla estado.
	\item \verb|FK_RECUERDO_ETAPA|: referencia a la tabla etapa.
	\item \verb|FK_RECUERDO_ETIQUETA|: referencia a la tabla etiqueta.
	\item \verb|FK_RECUERDO_PACIENTE|: referencia a la tabla paciente.
\end{itemize}

\subsection{Tabla multimedia}
Tabla con la información de los acrhivos multimedia de todos los pacientes. Estos archivos multimedia se utilizan tanto en las sesiones como en los recuerdos. Los atributos se pueden ver en la Figura \ref{fig:bd_multimedia}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/multimedia.png}
	\caption{Tabla de base de datos multimedia.}
	\label{fig:bd_multimedia}
\end{figure}

\subsection{Tabla evaluacion}
Tabla con la información de las evaluaciones que hacen los terapeutas a los pacientes para ver su progreso. Los atributos se pueden ver en la Figura \ref{fig:bd_evaluacion}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/evaluacion.png}
	\caption{Tabla de base de datos evaluacion.}
	\label{fig:bd_evaluacion}
\end{figure}

\subsection{Tabla \texttt{persona\char`_relacionada}}
Tabla con la información de las personas que están relacionadas con los pacientes. Los atributos se pueden ver en la Figura \ref{fig:bd_persona_relacionada}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/persona_relacionada.png}
	\caption{Tabla de base de datos \texttt{persona\char`_relacionada}.}
	\label{fig:bd_persona_relacionada}
\end{figure}

Esta tabla tiene las siguientes foreign keys:
\begin{itemize}
	\item \verb|FK_PERSONA_RELACIONADA_TIPO_RELACION|: referencia a la tabla \texttt{tipo\char`_relacion}.
	\item \verb|FK_PERSONA_RELACIONADA_PACIENTE|: referencia a la tabla paciente.
\end{itemize}

\subsection{Tabla actividad}
Tabla con la información de las actividades que el terapeuta ha asignado al paciente para que las realice con su cuidador. Los atributos se pueden ver en la Figura \ref{fig:bd_actividad}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/actividad.png}
	\caption{Tabla de base de datos actividad.}
	\label{fig:bd_actividad}
\end{figure}

Esta tabla tiene las siguientes foreign keys:
\begin{itemize}
	\item \verb|FK_ACTIVIDAD_PACIENTE|: referencia a la tabla paciente.
\end{itemize}

\subsection{Tabla \texttt{tipo\char`_relacion}}
Tabla que contiene los tipos de relación que pueden tener las personas que están relacionadas con los pacientes. Los atributos se pueden ver en la Figura \ref{fig:bd_tipo_relacion}. Esta tabla se carga inicialmente con los datos que se pueden ver en la Figura \ref{fig:bd_tipo_relacion_datos}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/tipo_relacion.png}
	\caption{Tabla de base de datos \texttt{tipo\char`_relacion}.}
	\label{fig:bd_tipo_relacion}
\end{figure}

\begin{figure}[!ht]
	\centering
	\includegraphics[width=3cm]{./Imagenes/Figuras/base_de_datos/tipo_relacion_datos.png}
	\caption{Datos de la tabla de base de datos \texttt{tipo\char`_relacion}.}
	\label{fig:bd_tipo_relacion_datos}
\end{figure}

\subsection{Tabla etiqueta}
Tabla que contiene las etiquetas que pueden tener los recuerdos de los pacientes y que sirven para indicar si un recuerdo es positivo, neutro o negativo. Los atributos se pueden ver en la Figura \ref{fig:bd_etiqueta}. Esta tabla se carga inicialmente con los datos que se pueden ver en la Figura \ref{fig:bd_etiqueta_datos}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/etiqueta.png}
	\caption{Tabla de base de datos etiqueta.}
	\label{fig:bd_etiqueta}
\end{figure}

\begin{figure}[!ht]
	\centering
	\includegraphics[width=3cm]{./Imagenes/Figuras/base_de_datos/etiqueta_datos.png}
	\caption{Datos de la tabla de base de datos etiqueta.}
	\label{fig:bd_etiqueta_datos}
\end{figure}

\subsection{Tabla etapa}
Tabla que contiene las etapas de vida que pueden tener las sesiones y los recuerdos de los pacientes. Los atributos se pueden ver en la Figura \ref{fig:bd_etapa}. Esta tabla se carga inicialmente con los datos que se pueden ver en la Figura \ref{fig:bd_etapa_datos}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/etapa.png}
	\caption{Tabla de base de datos etapa.}
	\label{fig:bd_etapa}
\end{figure}

\begin{figure}[!ht]
	\centering
	\includegraphics[width=3cm]{./Imagenes/Figuras/base_de_datos/etapa_datos.png}
	\caption{Datos de la tabla de base de datos etapa.}
	\label{fig:bd_etapa_datos}
\end{figure}

\subsection{Tabla estado}
Tabla que contiene las tipo de estados que pueden tener los recuerdos de los pacientes y que sirven para indicar si un recuerdo está conservado, en riesgo de perder o perdido. Los atributos se pueden ver en la Figura \ref{fig:bd_estado}. Esta tabla se carga inicialmente con los datos que se pueden ver en la Figura \ref{fig:bd_estado_datos}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/estado.png}
	\caption{Tabla de base de datos estado.}
	\label{fig:bd_estado}
\end{figure}

\begin{figure}[!ht]
	\centering
	\includegraphics[width=3cm]{./Imagenes/Figuras/base_de_datos/estado_datos.png}
	\caption{Datos de la tabla de base de datos estado.}
	\label{fig:bd_estado_datos}
\end{figure}

\subsection{Tabla emocion}
Tabla que contiene las tipo de emoción que pueden tener los recuerdos de los pacientes y que sirven para indicar la emoción que le surge al paciente con el recuerdo. Los atributos se pueden ver en la Figura \ref{fig:bd_emocion}. Esta tabla se carga inicialmente con los datos que se pueden ver en la Figura \ref{fig:bd_emocion_datos}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/emocion.png}
	\caption{Tabla de base de datos emocion.}
	\label{fig:bd_emocion}
\end{figure}

\begin{figure}[!ht]
	\centering
	\includegraphics[width=3cm]{./Imagenes/Figuras/base_de_datos/emocion_datos.png}
	\caption{Datos de la tabla de base de datos emocion.}
	\label{fig:bd_emocion_datos}
\end{figure}

\subsection{Tabla categoria}
Tabla que contiene las tipo de categorías que pueden tener los recuerdos de los pacientes y que sirven para indicar con qué está relacionado el recuerdo (familia, hobbies, amistad, trabajo, política, estudios u otros). Los atributos se pueden ver en la Figura \ref{fig:bd_categoria}. Esta tabla se carga inicialmente con los datos que se pueden ver en la Figura \ref{fig:bd_categoria_datos}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/categoria.png}
	\caption{Tabla de base de datos categoria.}
	\label{fig:bd_categoria}
\end{figure}

\begin{figure}[!ht]
	\centering
	\includegraphics[width=3cm]{./Imagenes/Figuras/base_de_datos/categoria_datos.png}
	\caption{Datos de la tabla de base de datos categoria.}
	\label{fig:bd_categoria_datos}
\end{figure}

\subsection{Tabla terapeuta}
Tabla con la relación de terapeutas y pacientes que sirve para asignar los pacientes a varios terapeutas. Los atributos se pueden ver en la Figura \ref{fig:bd_terapeuta}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/terapeuta.png}
	\caption{Tabla de base de datos terapeuta.}
	\label{fig:bd_terapeuta}
\end{figure}

Esta tabla tiene las siguientes foreign keys:
\begin{itemize}
	\item \verb|FK_TERAPEUTA_USUARIO|: referencia a la tabla usuario.
	\item \verb|FK_TERAPEUTA_PACIENTE|: referencia a la tabla paciente.
\end{itemize}

\subsection{Tabla \texttt{sesion\char`_recuerdo}}
Tabla con la relación de sesiones y recuerdos que sirve para asignar los recuerdos de los pacientes a las sesiones. Los atributos se pueden ver en la Figura \ref{fig:bd_sesion_recuerdo}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/sesion_recuerdo.png}
	\caption{Tabla de base de datos \texttt{sesion\char`_recuerdo}.}
	\label{fig:bd_sesion_recuerdo}
\end{figure}

Esta tabla tiene las siguientes foreign keys:
\begin{itemize}
	\item \verb|FK_SESION_RECUERDO_RECUERDO|: referencia a la tabla recuerdo.
	\item \verb|FK_SESION_RECUERDO_SESION|: referencia a la tabla sesion.
\end{itemize}

\subsection{Tabla \texttt{sesion\char`_multimedia}}
Tabla con la relación de sesiones y archivos multimedia que sirve para asignar los archivos multimedia a las sesiones de los pacientes. Los atributos se pueden ver en la Figura \ref{fig:bd_sesion_multimedia}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/sesion_multimedia.png}
	\caption{Tabla de base de datos \texttt{sesion\char`_multimedia}.}
	\label{fig:bd_sesion_multimedia}
\end{figure}

Esta tabla tiene las siguientes foreign keys:
\begin{itemize}
	\item \verb|FK_SESION_MULTIMEDIA_MULTIMEDIA|: referencia a la tabla multimedia.
	\item \verb|FK_SESION_MULTIMEDIA_SESION|: referencia a la tabla sesion.
\end{itemize}

\subsection{Tabla \texttt{recuerdo\char`_persona\char`_ralacionada}}
Tabla con la relación de recuerdos y personas relacionadas de los pacientes que sirve para asignar las personas relacionadas a los recuerdos de los pacientes. Los atributos se pueden ver en la Figura \ref{fig:bd_recuerdo_persona_relacionada}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/recuerdo_persona_relacionada.png}
	\caption{Tabla de base de datos \texttt{recuerdo\char`_persona\char`_relacionada}.}
	\label{fig:bd_recuerdo_persona_relacionada}
\end{figure}

Esta tabla tiene las siguientes foreign keys:
\begin{itemize}
	\item \verb|FK_RECUERDO_PERSONA_RELACIONADA_PERSONA_RELACIONADA|: referencia a la tabla \texttt{persona\char`_relacionada}.
	\item \verb|FK_RECUERDO_PERSONA_RELACIONADA_RECUERDO|: referencia a la tabla recuerdo.
\end{itemize}

\subsection{Tabla \texttt{recuerdo\char`_multimedia}}
Tabla con la relación de recuerdos y archivos multimedia que sirve para asignar los archivos multimedia a los recuerdos de los pacientes. Los atributos se pueden ver en la Figura \ref{fig:bd_recuerdo_multimedia}.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=14cm]{./Imagenes/Figuras/base_de_datos/recuerdo_multimedia.png}
	\caption{Tabla de base de datos \texttt{recuerdo\char`_multimedia}.}
	\label{fig:bd_recuerdo_multimedia}
\end{figure}

Esta tabla tiene las siguientes foreign keys:
\begin{itemize}
	\item \verb|FK_RECUERDO_MULTIMEDIA_MULTIMEDIA|: referencia a la tabla multimedia.
	\item \verb|FK_RECUERDO_MULTIMEDIA_RECUERDO|: referencia a la tabla recuerdo.
\end{itemize}


\section{Funcionalidades}
A continuación, se describirán todas las funcionalidades de la aplicación.

\subsection{Login}
Pantalla que permite al cuidador y al terapeuta iniciar sesión en la aplicación. Para ello, tienen que introducir su correo y contraseña como se muestra en la Figura \ref{fig:login}. En caso de que uno de los dos sea incorrecto se mostrará el error "Usuario o contraseña incorrectos.", en caso contrario se accederá a la pantalla inicial de la aplicación tal y como se muestra en el diagrama de secuencia que se muestra en la Figura .
\begin{figure}[!ht]
  	\centering
  	\includegraphics[width=8cm]{./Imagenes/Figuras/implementacion/login.png}
  	\caption{Pagina de login.}
	\label{fig:login}
\end{figure}

\begin{figure}[!ht]
  	\centering
  	\includegraphics[width=12cm]{./Imagenes/Figuras/diagramas_secuencia/login.png}
  	\caption{Diagrama de secuencia del proceso login.}
	\label{fig:login}
\end{figure}